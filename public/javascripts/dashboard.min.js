"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,a;const t=exports.Emile,n=document.querySelector("#container--dashboard"),s=document.querySelector("#form--dashboard");let i={};function d(e,a){return`${e}_${a}`}function l(e){return new Date(1e3*e).toLocaleString()}function r(e,a,t){e.data.labels.push(a);for(const a of e.data.datasets)a.data.push(t)}function o(e,a){var t,n,s,i;const d=document.createElement("tr");d.innerHTML=`<td>${l(a.timeSeconds)}</td>\n      <td>${null!==(t=a.readingType)&&void 0!==t?t:""}</td>\n      <td>${null!==(n=a.commodity)&&void 0!==n?n:""}</td>\n      <td class="has-text-right">${a.dataValue}</td>\n      <td>${null!==(s=a.unit)&&void 0!==s?s:""}</td>`,null===(i=e.querySelector("tbody"))||void 0===i||i.append(d)}function c(){n.innerHTML='<p class="has-text-centered has-text-grey">\n      <i class="fas fa-pulse fa-spinner fa-4x" aria-hidden="true"></i><br />\n      Loading data...\n      </p>',cityssm.postJSON(`${t.urlPrefix}/dashboard/doGetEnergyData`,s,e=>{var a,s,c;const h=e;n.innerHTML="",i={};for(const e of h.energyData){const t=d(e.assetId,e.dataTypeId);if(void 0===i[t]){const d=document.createElement("div");d.className="panel",d.innerHTML=`<div class="panel-heading">\n              <div class="level is-mobile">\n                <div class="level-left">\n                  <div class="level-item">\n                    <i class="${null!==(a=e.fontAwesomeIconClasses)&&void 0!==a?a:"fas fa-bolt"}" aria-hidden="true"></i>\n                  </div>\n                  <div class="level-item is-block">\n                    <h2 class="has-text-weight-bold" data-field="assetName"></h2>\n                    <span class="has-text-weight-normal" data-field="serviceCategory"></span>\n                  </div>\n                </div>\n                <div class="level-right">\n                  <div class="level-item">\n                    <div class="tabs is-toggle is-toggle-rounded">\n                      <ul>\n                        <li class="is-active">\n                          <a href="#chartTab_${t}">\n                            <span class="icon is-small"><i class="fas fa-chart-bar" aria-hidden="true"></i></span>\n                            <span>Chart</span>\n                          </a>\n                        </li>\n                        <li>\n                          <a href="#tableTab_${t}">\n                            <span class="icon is-small"><i class="fas fa-table" aria-hidden="true"></i></span>\n                            <span>Table</span>\n                          </a>\n                        </li>\n                      </ul>\n                    </div>\n                  </div>\n                  <div class="level-item">\n                    <a class="button is-export-link" download>\n                      <span class="icon is-small"><i class="fas fa-file-csv" aria-hidden="true"></i></span>\n                      <span class="has-text-weight-normal">Export</span>\n                    </a>\n                  </div>\n                </div>\n              </div>\n              </div>\n              <div class="tabs-container panel-block is-block">\n                <div id="chartTab_${t}">\n                  <canvas style="max-height:400px"></canvas>\n                </div>\n                <div id="tableTab_${t}" class="is-hidden">\n                  <table class="table is-fullwidth is-striped is-hoverable has-sticky-header">\n                    <thead>\n                      <tr>\n                        <th>Time</th>\n                        <th>Reading Type</th>\n                        <th>Commodity</th>\n                        <th class="has-text-right">Value</th>\n                        <th>Unit</th>\n                      </tr>\n                    </thead>\n                    <tbody></tbody>\n                  </table>\n                </div>\n              </div>`,d.querySelector('[data-field="assetName"]').textContent=null!==(s=e.assetName)&&void 0!==s?s:"",d.querySelector('[data-field="serviceCategory"]').textContent=null!==(c=e.serviceCategory)&&void 0!==c?c:"",n.append(d);const r=new Chart(d.querySelector("canvas"),{type:"bar",data:{labels:[l(e.timeSeconds)],datasets:[{label:e.unit,data:[e.dataValue*Math.pow(10,e.powerOfTenMultiplier)]}]}}),h=d.querySelector("table");i[t]={chart:r,table:h,exportLink:n.querySelector(".is-export-link"),assetId:e.assetId,dataTypeId:e.dataTypeId,timeSecondsMin:e.timeSeconds,timeSecondsMax:e.timeSeconds},o(h,e)}else r(i[t].chart,l(e.timeSeconds),e.dataValue*Math.pow(10,e.powerOfTenMultiplier)),o(i[t].table,e),i[t].timeSecondsMin=Math.min(i[t].timeSecondsMin,e.timeSeconds),i[t].timeSecondsMax=Math.max(i[t].timeSecondsMax,e.timeSeconds)}for(const e of Object.values(i))e.chart.update(),e.exportLink.href=`${t.urlPrefix}/reports/energyData-formatted-filtered/?assetId=${e.assetId}&dataTypeId=${e.dataTypeId}&timeSecondsMin=${e.timeSecondsMin}&timeSecondsMax=${e.timeSecondsMax}`;bulmaJS.init(n)})}t.initializeAssetSelector({assetSelectorElement:s.querySelector("#dashboard--assetSelector"),callbackFunction:c}),null===(e=s.querySelector("#dashboard--startDateString"))||void 0===e||e.addEventListener("change",c),null===(a=s.querySelector("#dashboard--endDateString"))||void 0===a||a.addEventListener("change",c),s.addEventListener("submit",e=>{e.preventDefault(),c()}),c()})();