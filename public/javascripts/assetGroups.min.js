"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e;const t=exports.Emile,s=document.querySelector("#filter--assetGroups");function r(e){var s,r;const a=e.currentTarget.closest("tr"),n=null!==(s=a.dataset.groupId)&&void 0!==s?s:"",u=null!==(r=a.dataset.assetId)&&void 0!==r?r:"";bulmaJS.confirm({title:"Delete Group Member",message:"Are you sure you want to remove this asset from this group?",contextualColorName:"warning",okButton:{text:"Yes, Remove Member from Group",callbackFunction:function(){cityssm.postJSON(`${t.urlPrefix}/assets/doDeleteAssetGroupMember`,{groupId:n,assetId:u},e=>{var t;const s=e;s.success?o(n,s.groupMembers):bulmaJS.alert({title:"Error Deleting Group Member",message:null!==(t=s.errorMessage)&&void 0!==t?t:"Please try again.",contextualColorName:"danger"})})}}})}function o(e,s){var o,a,n,u,l,d;const i=document.querySelector(".modal #tbody--groupMembers");i.innerHTML="";for(const u of s){const s=document.createElement("tr");s.dataset.groupId=e,s.dataset.assetId=u.assetId.toString(),s.innerHTML=`<td data-field="category"></td>\n        <td data-field="assetName"></td>\n        <td>\n          ${t.canUpdate?'<button class="button is-danger is-delete-button" type="button">\n                  <span class="icon"><i class="fas fa-trash" aria-hidden="true"></i></span>\n                  <span>Delete Member</span>\n                  </button>':""}\n        </td>`,s.querySelector('[data-field="category"]').textContent=null!==(o=u.category)&&void 0!==o?o:"",s.querySelector('[data-field="assetName"]').textContent=null!==(a=u.assetName)&&void 0!==a?a:"",null===(n=s.querySelector(".is-delete-button"))||void 0===n||n.addEventListener("click",r),i.append(s)}if(t.canUpdate){const e=document.querySelector(".modal #groupMemberAdd--assetId");e.innerHTML='<option value="">(Select an Asset)</option>';for(const r of t.assets){if(s.some(e=>e.assetId===r.assetId))continue;const t=document.createElement("option");t.value=r.assetId.toString(),t.textContent=r.assetName;let o=e.querySelector(`optgroup[data-category-id="${null!==(u=r.categoryId)&&void 0!==u?u:""}"]`);null===o&&((o=document.createElement("optgroup")).dataset.categoryId=null===(l=r.categoryId)||void 0===l?void 0:l.toString(),o.label=null!==(d=r.category)&&void 0!==d?d:"",e.append(o)),o.append(t)}}}function a(e){e.preventDefault(),cityssm.postJSON(`${t.urlPrefix}/assets/doUpdateAssetGroup`,e.currentTarget,e=>{var s;const r=e;r.success?(t.assetGroups=r.assetGroups,bulmaJS.alert({message:"Asset group updated successfully.",contextualColorName:"success"}),d()):bulmaJS.alert({title:"Error Updating Asset Group",message:null!==(s=r.errorMessage)&&void 0!==s?s:"Please try again.",contextualColorName:"danger"})})}function n(e){e.preventDefault();const s=e.currentTarget;cityssm.postJSON(`${t.urlPrefix}/assets/doAddAssetGroupMember`,s,e=>{var t;const r=e;r.success?(o(s.querySelector('[name="groupId"]').value,r.groupMembers),s.reset()):bulmaJS.alert({title:"Error Adding Group Member",message:null!==(t=r.errorMessage)&&void 0!==t?t:"Please try again.",contextualColorName:"danger"})})}function u(e){let s;function r(r){r.preventDefault(),bulmaJS.confirm({title:"Delete Asset Group",message:"Are you sure you want to delete this group?",contextualColorName:"warning",okButton:{text:"Yes, Delete Asset Group",callbackFunction:function(){cityssm.postJSON(`${t.urlPrefix}/assets/doDeleteAssetGroup`,{groupId:e},e=>{var r;const o=e;o.success?(t.assetGroups=o.assetGroups,d(),s()):bulmaJS.alert({title:"Error Deleting Asset Group",message:null!==(r=o.errorMessage)&&void 0!==r?r:"",contextualColorName:"danger"})})}}})}cityssm.openHtmlModal("assetGroup-view",{onshow(s){var r;!function(e,s){cityssm.postJSON(`${t.urlPrefix}/assets/doGetAssetGroup`,{groupId:s},t=>{var r,a,n;const u=t;u.success?(e.querySelector("#assetGroupView--groupId").value=null!==(a=null===(r=u.assetGroup.groupId)||void 0===r?void 0:r.toString())&&void 0!==a?a:"",e.querySelector('.modal-card-head [data-field="groupName"]').textContent=u.assetGroup.groupName,e.querySelector("#assetGroupView--groupName").value=u.assetGroup.groupName,e.querySelector("#assetGroupView--isShared").value=u.assetGroup.isShared?"1":"0",e.querySelector("#assetGroupView--groupDescription").value=u.assetGroup.groupDescription,o(s,null!==(n=u.assetGroup.groupMembers)&&void 0!==n?n:[])):bulmaJS.alert({title:"Error Loading Asset Group Details",message:"Please refresh the page and try again.",contextualColorName:"danger"})})}(s,e),t.canUpdate?(s.querySelector("#form--assetGroupView fieldset").disabled=!1,s.querySelector("#groupMemberAdd--groupId").value=e):null===(r=s.querySelector("#tbody--groupMemberAdd"))||void 0===r||r.remove()},onshown(e,o){var u,l,d;bulmaJS.toggleHtmlClipped(),bulmaJS.init(e),t.canUpdate&&(s=o,null===(u=e.querySelector("#form--assetGroupView"))||void 0===u||u.addEventListener("submit",a),null===(l=e.querySelector(".is-delete-button"))||void 0===l||l.addEventListener("click",r),null===(d=e.querySelector("#form--groupMemberAdd"))||void 0===d||d.addEventListener("submit",n))},onremoved(){bulmaJS.toggleHtmlClipped()}})}function l(e){var t,s;e.preventDefault(),u(null!==(s=null===(t=e.currentTarget.closest("tr"))||void 0===t?void 0:t.dataset.groupId)&&void 0!==s?s:"")}function d(){var e,r,o;document.querySelector("#count--assetGroups").textContent=t.assetGroups.length.toString();const a=document.querySelector("#container--assetGroups");if(0===t.assetGroups.length)return void(a.innerHTML='<div class="message is-info">\n        <p class="message-body">\n          <strong>No Asset Groups Found</strong><br />\n          Grouping together assets can assist with reporting on multiple assets.\n        </p>\n        </div>');const n=s.value.trim().toLowerCase().split(" "),u=document.createElement("table");u.className="table is-fullwidth is-striped has-sticky-header is-fade-hoverable",u.innerHTML='<thead><tr>\n      <th>Group</th>\n      <th class="has-text-right">Members</th>\n      <th class="has-text-right">Shared</th>\n      </tr></thead>\n      <tbody></tbody>';e:for(const s of t.assetGroups){const t=`${s.groupName} ${null!==(e=s.groupDescription)&&void 0!==e?e:""}`.toLowerCase();for(const e of n)if(!t.includes(e))continue e;const a=document.createElement("tr");a.dataset.groupId=s.groupId.toString(),a.innerHTML=`<td>\n          <a class="has-text-weight-bold" data-field="groupName" href="#"></a><br />\n          <span class="is-size-7" data-field="groupDescription"></span>\n        </td>\n        <td class="has-text-right">\n          ${null!==(r=s.groupMemberCount)&&void 0!==r?r:0}\n        </td>\n        <td class="has-text-right">\n          ${s.isShared?"Shared Group":"Private"}\n        </td>`;const d=a.querySelector('[data-field="groupName"]');d.textContent=s.groupName,d.addEventListener("click",l),u.querySelector("tbody").append(a),a.querySelector('[data-field="groupDescription"]').textContent=null!==(o=s.groupDescription)&&void 0!==o?o:""}0===u.querySelectorAll("tbody tr").length?a.innerHTML='<div class="message is-info">\n        <p class="message-body">\n          <strong>There are no groups that meet your search criteria.</strong><br />\n          Try to be less specific in your search. \n        </p>\n        </div>':(a.innerHTML="",a.append(u))}null===(e=document.querySelector("#button--addAssetGroup"))||void 0===e||e.addEventListener("click",()=>{let e;function s(s){s.preventDefault(),cityssm.postJSON(`${t.urlPrefix}/assets/doAddAssetGroup`,s.currentTarget,s=>{const r=s;r.success&&(t.assetGroups=r.assetGroups,d(),e(),u(r.groupId.toString()))})}cityssm.openHtmlModal("assetGroup-add",{onshown(t,r){var o;e=r,bulmaJS.toggleHtmlClipped(),t.querySelector("#assetGroupAdd--groupName").focus(),null===(o=t.querySelector("form"))||void 0===o||o.addEventListener("submit",s)},onremoved(){bulmaJS.toggleHtmlClipped()}})}),s.addEventListener("keyup",d),d()})();