"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e;const t=exports.Emile,s=exports.assetAliasTypes,a=document.querySelector("#filter--categoryId"),o=document.querySelector("#filter--assets");function n(e){const s=e.currentTarget.closest("tr"),a=s.dataset.aliasId,o=s.dataset.assetId;bulmaJS.confirm({title:"Delete Asset Alias",message:"Are you sure you want to remove this asset alias?",contextualColorName:"warning",okButton:{text:"Yes, Remove Alias",callbackFunction:function(){cityssm.postJSON(`${t.urlPrefix}/assets/doDeleteAssetAlias`,{aliasId:a,assetId:o},e=>{var t;const s=e;s.success?l(s.assetAliases):bulmaJS.alert({title:"Error Deleting Alias",message:null!==(t=s.errorMessage)&&void 0!==t?t:"Please try again.",contextualColorName:"danger"})})}}})}function l(e){var s,a,o;const l=document.querySelector(".modal #tbody--assetAliases");l.innerHTML="";for(const r of e){const e=document.createElement("tr");e.dataset.aliasId=r.aliasId.toString(),e.dataset.assetId=r.assetId.toString(),e.innerHTML=`<td data-field="aliasType"></td>\n        <td data-field="assetAlias"></td>\n        <td>\n          ${t.canUpdate?'<button class="button is-danger is-delete-button" type="button">\n                  <span class="icon"><i class="fas fa-trash" aria-hidden="true"></i></span>\n                  <span>Delete Alias</span>\n                  </button>':""}\n        </td>`,e.querySelector('[data-field="aliasType"]').textContent=null!==(s=r.aliasType)&&void 0!==s?s:"",e.querySelector('[data-field="assetAlias"]').textContent=null!==(a=r.assetAlias)&&void 0!==a?a:"",null===(o=e.querySelector(".is-delete-button"))||void 0===o||o.addEventListener("click",n),l.append(e)}}function r(e){e.preventDefault(),cityssm.postJSON(`${t.urlPrefix}/assets/doUpdateAsset`,e.currentTarget,e=>{var s;const a=e;a.success?(t.assets=a.assets,bulmaJS.alert({message:"Asset updated successfully.",contextualColorName:"success"}),u()):bulmaJS.alert({title:"Error Updating Asset",message:null!==(s=a.errorMessage)&&void 0!==s?s:"Please try again.",contextualColorName:"danger"})})}function i(e){e.preventDefault();const s=e.currentTarget;cityssm.postJSON(`${t.urlPrefix}/assets/doAddAssetAlias`,s,e=>{var t;const a=e;a.success?(l(a.assetAliases),s.reset()):bulmaJS.alert({title:"Error Adding Alias",message:null!==(t=a.errorMessage)&&void 0!==t?t:"Please try again.",contextualColorName:"danger"})})}function d(e){let a;function o(s){s.preventDefault(),bulmaJS.confirm({title:"Delete Asset",message:"Are you sure you want to delete this asset?",contextualColorName:"warning",okButton:{text:"Yes, Delete Asset",callbackFunction:function(){cityssm.postJSON(t.urlPrefix+"/assets/doDeleteAsset",{assetId:e},e=>{var s;const o=e;o.success?(t.assets=o.assets,u(),a()):bulmaJS.alert({title:"Error Deleting Asset",message:null!==(s=o.errorMessage)&&void 0!==s?s:"",contextualColorName:"danger"})})}}})}cityssm.openHtmlModal("asset-view",{onshow(a){var o;if(function(e,s){cityssm.postJSON(`${t.urlPrefix}/assets/doGetAsset`,{assetId:s},s=>{var a,o,n,r,i,d,c,u,m,v,g,y;const p=s;if(!p.success)return void bulmaJS.alert({title:"Error Loading Asset Details",message:"Please refresh the page and try again.",contextualColorName:"danger"});e.querySelector("#assetView--assetId").value=null!==(o=null===(a=p.asset.assetId)||void 0===a?void 0:a.toString())&&void 0!==o?o:"",e.querySelector('.modal-card-head [data-field="assetName"]').textContent=p.asset.assetName;const f=e.querySelector("#assetView--categoryId");let S=!1;if(t.canUpdate)for(const e of t.assetCategories){const t=document.createElement("option");t.value=null!==(r=null===(n=e.categoryId)||void 0===n?void 0:n.toString())&&void 0!==r?r:"",t.textContent=e.category,e.categoryId===p.asset.categoryId&&(t.selected=!0,S=!0),f.append(t)}if(!S){const e=document.createElement("option");e.value=null!==(d=null===(i=p.asset.categoryId)||void 0===i?void 0:i.toString())&&void 0!==d?d:"",e.textContent=null!==(c=p.asset.category)&&void 0!==c?c:"",e.selected=!0,f.append(e)}e.querySelector("#assetView--assetName").value=p.asset.assetName,e.querySelector("#assetView--latitude").value=null!==(m=null===(u=p.asset.latitude)||void 0===u?void 0:u.toFixed(6))&&void 0!==m?m:"",e.querySelector("#assetView--longitude").value=null!==(g=null===(v=p.asset.longitude)||void 0===v?void 0:v.toFixed(6))&&void 0!==g?g:"",l(null!==(y=p.asset.assetAliases)&&void 0!==y?y:[])})}(a,e),t.canUpdate){a.querySelector("#form--assetView fieldset").disabled=!1,a.querySelector("#assetAliasAdd--assetId").value=e;const t=a.querySelector("#assetAliasAdd--aliasTypeId");for(const e of s){const s=document.createElement("option");s.value=e.aliasTypeId.toString(),s.textContent=e.aliasType,t.append(s)}}else null===(o=a.querySelector("#tbody--assetAliasAdd"))||void 0===o||o.remove()},onshown(e,t){var s,n,l;bulmaJS.toggleHtmlClipped(),bulmaJS.init(e),a=t,null===(s=e.querySelector("#form--assetView"))||void 0===s||s.addEventListener("submit",r),null===(n=e.querySelector(".is-delete-button"))||void 0===n||n.addEventListener("click",o),null===(l=e.querySelector("#form--assetAliasAdd"))||void 0===l||l.addEventListener("submit",i)},onremoved(){bulmaJS.toggleHtmlClipped()}})}function c(e){var t,s;e.preventDefault(),d(null!==(s=null===(t=e.currentTarget.closest("tr"))||void 0===t?void 0:t.dataset.assetId)&&void 0!==s?s:"")}function u(){var e,s,n,l,r,i,d,u,m,v;document.querySelector("#count--assets").textContent=t.assets.length.toString();const g=document.querySelector("#container--assets");if(0===t.assets.length)return void(g.innerHTML='<div class="message is-warning">\n        <p class="message-body">\n          <strong>No Assets Found</strong><br />\n          Get started by adding some assets that will be reported on.\n        </p>\n        </div>');const y=o.value.trim().toLowerCase().split(" "),p=document.createElement("table");p.className="table is-fullwidth is-striped has-sticky-header",p.innerHTML='<thead><tr>\n      <th class="has-width-10"></th>\n      <th>Category</th>\n      <th>Asset</th>\n      <th class="has-text-centered has-width-10">\n        <i class="far fa-map" aria-hidden="true"></i>\n        <span class="is-sr-only">Map</span>\n      </th>\n      </tr></thead>\n      <tbody></tbody>';e:for(const o of t.assets){if(""!==a.value&&a.value!==(null===(e=o.categoryId)||void 0===e?void 0:e.toString()))continue;const g=o.assetName.toLowerCase()+" "+(null!==(s=o.category)&&void 0!==s?s:"").toLowerCase();for(const e of y)if(!g.includes(e))continue e;const f=document.createElement("tr");f.dataset.assetId=null!==(l=null===(n=o.assetId)||void 0===n?void 0:n.toString())&&void 0!==l?l:"",f.innerHTML=`<td class="has-width-10 has-text-centered">\n        <i class="${null!==(r=o.fontAwesomeIconClasses)&&void 0!==r?r:"fas fa-bolt"}" aria-hidden="true"></i>\n        </td>\n        <td data-field="category"></td>\n        <td><a data-field="assetName" href="#"></a></td>\n        <td class="has-width-10 has-text-centered has-text-nowrap">\n          ${""===(null!==(i=o.latitude)&&void 0!==i?i:"")||""===(null!==(d=o.longitude)&&void 0!==d?d:"")?"":`<a class="has-tooltip-left" data-tooltip="Open Map" href="${t.getMapLink(o.latitude,o.longitude)}" target="_blank" rel="noopener noreferrer" aria-label="Open Map">\n                <i class="fas fa-map-marker-alt" aria-hidden="true"></i>\n                ${null!==(u=o.latitude)&&void 0!==u?u:0}, ${null!==(m=o.longitude)&&void 0!==m?m:0}\n                </a>`}\n        </td>`,f.querySelector('[data-field="category"]').textContent=null!==(v=o.category)&&void 0!==v?v:"";const S=f.querySelector('[data-field="assetName"]');S.textContent=o.assetName,S.addEventListener("click",c),p.querySelector("tbody").append(f)}0===p.querySelectorAll("tbody tr").length?g.innerHTML='<div class="message is-info">\n        <p class="message-body">\n          <strong>There are no assets that meet your search criteria.</strong><br />\n          Try to be less specific in your search. \n        </p>\n        </div>':(g.innerHTML="",g.append(p))}null===(e=document.querySelector("#button--addAsset"))||void 0===e||e.addEventListener("click",()=>{let e;function s(s){s.preventDefault(),cityssm.postJSON(t.urlPrefix+"/assets/doAddAsset",s.currentTarget,s=>{const a=s;a.success&&(t.assets=a.assets,u(),e(),d(a.assetId.toString()))})}cityssm.openHtmlModal("asset-add",{onshow(e){var s,a;const o=e.querySelector("#assetAdd--categoryId");for(const e of t.assetCategories){const t=document.createElement("option");t.value=null!==(a=null===(s=e.categoryId)||void 0===s?void 0:s.toString())&&void 0!==a?a:"",t.textContent=e.category,o.append(t)}},onshown(t,a){var o;e=a,bulmaJS.toggleHtmlClipped(),t.querySelector("#assetAdd--categoryId").focus(),null===(o=t.querySelector("form"))||void 0===o||o.addEventListener("submit",s)},onremoved(){bulmaJS.toggleHtmlClipped()}})}),o.addEventListener("keyup",u),a.addEventListener("change",u),u()})();