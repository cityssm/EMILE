"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,t;const s=exports.Emile,a=exports.assetAliasTypes,o=document.querySelector("#filter--categoryId"),r=document.querySelector("#filter--assets");function n(e){const t=e.currentTarget.closest("tr"),a=t.dataset.aliasId,o=t.dataset.assetId;bulmaJS.confirm({title:"Delete Asset Alias",message:"Are you sure you want to remove this asset alias?",contextualColorName:"warning",okButton:{text:"Yes, Remove Alias",callbackFunction:function(){cityssm.postJSON(s.urlPrefix+"/assets/doDeleteAssetAlias",{aliasId:a,assetId:o},e=>{var t;const s=e;s.success?l(s.assetAliases):bulmaJS.alert({title:"Error Deleting Alias",message:null!==(t=s.errorMessage)&&void 0!==t?t:"Please try again.",contextualColorName:"danger"})})}}})}function l(e){var t,a,o;const r=document.querySelector(".modal #tbody--assetAliases");r.innerHTML="";for(const l of e){const e=document.createElement("tr");e.dataset.aliasId=l.aliasId.toString(),e.dataset.assetId=l.assetId.toString(),e.innerHTML=`<td data-field="aliasType"></td>\n        <td data-field="assetAlias"></td>\n        <td>\n          ${s.canUpdate?'<button class="button is-danger is-delete-button" type="button">\n                  <span class="icon"><i class="fas fa-trash" aria-hidden="true"></i></span>\n                  <span>Delete Alias</span>\n                  </button>':""}\n        </td>`,e.querySelector('[data-field="aliasType"]').textContent=null!==(t=l.aliasType)&&void 0!==t?t:"",e.querySelector('[data-field="assetAlias"]').textContent=null!==(a=l.assetAlias)&&void 0!==a?a:"",null===(o=e.querySelector(".is-delete-button"))||void 0===o||o.addEventListener("click",n),r.append(e)}}function i(e){e.preventDefault(),cityssm.postJSON(s.urlPrefix+"/assets/doUpdateAsset",e.currentTarget,e=>{var t;const a=e;a.success?(s.assets=a.assets,bulmaJS.alert({message:"Asset updated successfully.",contextualColorName:"success"}),p()):bulmaJS.alert({title:"Error Updating Asset",message:null!==(t=a.errorMessage)&&void 0!==t?t:"Please try again.",contextualColorName:"danger"})})}function d(e){e.preventDefault();const t=e.currentTarget;cityssm.postJSON(s.urlPrefix+"/assets/doAddAssetAlias",t,e=>{var s;const a=e;a.success?(l(a.assetAliases),t.reset()):bulmaJS.alert({title:"Error Adding Alias",message:null!==(s=a.errorMessage)&&void 0!==s?s:"Please try again.",contextualColorName:"danger"})})}function u(e){let t;function o(a){a.preventDefault(),bulmaJS.confirm({title:"Delete Asset",message:"Are you sure you want to delete this asset?",contextualColorName:"warning",okButton:{text:"Yes, Delete Asset",callbackFunction:function(){cityssm.postJSON(s.urlPrefix+"/assets/doDeleteAsset",{assetId:e},e=>{var a;const o=e;o.success?(s.assets=o.assets,p(),t()):bulmaJS.alert({title:"Error Deleting Asset",message:null!==(a=o.errorMessage)&&void 0!==a?a:"",contextualColorName:"danger"})})}}})}cityssm.openHtmlModal("asset-view",{onshow(t){var o;if(function(e,t){cityssm.postJSON(s.urlPrefix+"/assets/doGetAsset",{assetId:t},t=>{var a,o,r,n,i,d,u,c,p,m,g,v;const y=t;if(!y.success)return void bulmaJS.alert({title:"Error Loading Asset Details",message:"Please refresh the page and try again.",contextualColorName:"danger"});e.querySelector("#assetView--assetId").value=null!==(o=null===(a=y.asset.assetId)||void 0===a?void 0:a.toString())&&void 0!==o?o:"",e.querySelector('.modal-card-head [data-field="assetName"]').textContent=y.asset.assetName;const f=e.querySelector("#assetView--categoryId");let S=!1;if(s.canUpdate)for(const e of s.assetCategories){const t=document.createElement("option");t.value=null!==(n=null===(r=e.categoryId)||void 0===r?void 0:r.toString())&&void 0!==n?n:"",t.textContent=e.category,e.categoryId===y.asset.categoryId&&(t.selected=!0,S=!0),f.append(t)}if(!S){const e=document.createElement("option");e.value=null!==(d=null===(i=y.asset.categoryId)||void 0===i?void 0:i.toString())&&void 0!==d?d:"",e.textContent=null!==(u=y.asset.category)&&void 0!==u?u:"",e.selected=!0,f.append(e)}e.querySelector("#assetView--assetName").value=y.asset.assetName,e.querySelector("#assetView--latitude").value=null!==(p=null===(c=y.asset.latitude)||void 0===c?void 0:c.toFixed(6))&&void 0!==p?p:"",e.querySelector("#assetView--longitude").value=null!==(g=null===(m=y.asset.longitude)||void 0===m?void 0:m.toFixed(6))&&void 0!==g?g:"",l(null!==(v=y.asset.assetAliases)&&void 0!==v?v:[])})}(t,e),s.canUpdate){t.querySelector("#form--assetView fieldset").disabled=!1,t.querySelector("#assetAliasAdd--assetId").value=e;const s=t.querySelector("#assetAliasAdd--aliasTypeId");for(const e of a){const t=document.createElement("option");t.value=e.aliasTypeId.toString(),t.textContent=e.aliasType,s.append(t)}}else null===(o=t.querySelector("#tbody--assetAliasAdd"))||void 0===o||o.remove()},onshown(e,s){var a,r,n;bulmaJS.toggleHtmlClipped(),bulmaJS.init(e),t=s,null===(a=e.querySelector("#form--assetView"))||void 0===a||a.addEventListener("submit",i),null===(r=e.querySelector(".is-delete-button"))||void 0===r||r.addEventListener("click",o),null===(n=e.querySelector("#form--assetAliasAdd"))||void 0===n||n.addEventListener("submit",d)},onremoved(){bulmaJS.toggleHtmlClipped()}})}function c(e){var t,s;e.preventDefault(),u(null!==(s=null===(t=e.currentTarget.closest("tr"))||void 0===t?void 0:t.dataset.assetId)&&void 0!==s?s:"")}function p(){var e,t,a,n,l,i,d,u,p,m;document.querySelector("#count--assets").textContent=s.assets.length.toString();const g=document.querySelector("#container--assets");if(0===s.assets.length)return void(g.innerHTML='<div class="message is-warning">\n        <p class="message-body">\n          <strong>No Assets Found</strong><br />\n          Get started by adding some assets that will be reported on.\n        </p>\n        </div>');const v=r.value.trim().toLowerCase().split(" "),y=document.createElement("table");y.className="table is-fullwidth is-striped has-sticky-header",y.innerHTML='<thead><tr>\n      <th class="has-width-10"></th>\n      <th>Category</th>\n      <th>Asset</th>\n      <th class="has-text-centered has-width-10">\n        <i class="far fa-map" aria-hidden="true"></i>\n        <span class="is-sr-only">Map</span>\n      </th>\n      </tr></thead>\n      <tbody></tbody>';e:for(const r of s.assets){if(""!==o.value&&o.value!==(null===(e=r.categoryId)||void 0===e?void 0:e.toString()))continue;const g=r.assetName.toLowerCase()+" "+(null!==(t=r.category)&&void 0!==t?t:"").toLowerCase();for(const e of v)if(!g.includes(e))continue e;const f=document.createElement("tr");f.dataset.assetId=null!==(n=null===(a=r.assetId)||void 0===a?void 0:a.toString())&&void 0!==n?n:"",f.innerHTML=`<td class="has-width-10 has-text-centered">\n        <i class="${null!==(l=r.fontAwesomeIconClasses)&&void 0!==l?l:"fas fa-bolt"}" aria-hidden="true"></i>\n        </td>\n        <td data-field="category"></td>\n        <td><a data-field="assetName" href="#"></a></td>\n        <td class="has-width-10 has-text-centered has-text-nowrap">\n          ${""===(null!==(i=r.latitude)&&void 0!==i?i:"")||""===(null!==(d=r.longitude)&&void 0!==d?d:"")?"":`<a class="has-tooltip-left" data-tooltip="Open Map" href="${s.getMapLink(r.latitude,r.longitude)}" target="_blank" rel="noopener noreferrer" aria-label="Open Map">\n                <i class="fas fa-map-marker-alt" aria-hidden="true"></i>\n                ${null!==(u=r.latitude)&&void 0!==u?u:0}, ${null!==(p=r.longitude)&&void 0!==p?p:0}\n                </a>`}\n        </td>`,f.querySelector('[data-field="category"]').textContent=null!==(m=r.category)&&void 0!==m?m:"";const S=f.querySelector('[data-field="assetName"]');S.textContent=r.assetName,S.addEventListener("click",c),y.querySelector("tbody").append(f)}0===y.querySelectorAll("tbody tr").length?g.innerHTML='<div class="message is-info">\n        <p class="message-body">\n          <strong>There are no assets that meet your search criteria.</strong><br />\n          Try to be less specific in your search. \n        </p>\n        </div>':(g.innerHTML="",g.append(y))}null===(e=document.querySelector("#button--addAsset"))||void 0===e||e.addEventListener("click",()=>{let e;function t(t){t.preventDefault(),cityssm.postJSON(s.urlPrefix+"/assets/doAddAsset",t.currentTarget,t=>{const a=t;a.success&&(s.assets=a.assets,p(),e(),u(a.assetId.toString()))})}cityssm.openHtmlModal("asset-add",{onshow(e){var t,a;const o=e.querySelector("#assetAdd--categoryId");for(const e of s.assetCategories){const s=document.createElement("option");s.value=null!==(a=null===(t=e.categoryId)||void 0===t?void 0:t.toString())&&void 0!==a?a:"",s.textContent=e.category,o.append(s)}},onshown(s,a){var o;e=a,bulmaJS.toggleHtmlClipped(),s.querySelector("#assetAdd--categoryId").focus(),null===(o=s.querySelector("form"))||void 0===o||o.addEventListener("submit",t)},onremoved(){bulmaJS.toggleHtmlClipped()}})});const m=document.querySelector("#filter--assetGroups");function g(e){e.preventDefault(),cityssm.postJSON(s.urlPrefix+"/assets/doUpdateAssetGroup",e.currentTarget,e=>{var t;const a=e;a.success?(s.assetGroups=a.assetGroups,bulmaJS.alert({message:"Asset group updated successfully.",contextualColorName:"success"}),p()):bulmaJS.alert({title:"Error Updating Asset Group",message:null!==(t=a.errorMessage)&&void 0!==t?t:"Please try again.",contextualColorName:"danger"})})}function v(e){let t;function a(a){a.preventDefault(),bulmaJS.confirm({title:"Delete Asset Group",message:"Are you sure you want to delete this group?",contextualColorName:"warning",okButton:{text:"Yes, Delete Asset Group",callbackFunction:function(){cityssm.postJSON(s.urlPrefix+"/assets/doDeleteAssetGroup",{groupId:e},e=>{var a;const o=e;o.success?(s.assetGroups=o.assetGroups,f(),t()):bulmaJS.alert({title:"Error Deleting Asset Group",message:null!==(a=o.errorMessage)&&void 0!==a?a:"",contextualColorName:"danger"})})}}})}cityssm.openHtmlModal("assetGroup-view",{onshow(t){!function(e,t){cityssm.postJSON(s.urlPrefix+"/assets/doGetAssetGroup",{groupId:t},t=>{var s,a;const o=t;o.success?(e.querySelector("#assetGroupView--groupId").value=null!==(a=null===(s=o.assetGroup.groupId)||void 0===s?void 0:s.toString())&&void 0!==a?a:"",e.querySelector('.modal-card-head [data-field="groupName"]').textContent=o.assetGroup.groupName,e.querySelector("#assetGroupView--groupName").value=o.assetGroup.groupName,e.querySelector("#assetGroupView--isShared").value=o.assetGroup.isShared?"1":"0",e.querySelector("#assetGroupView--groupDescription").value=o.assetGroup.groupDescription):bulmaJS.alert({title:"Error Loading Asset Group Details",message:"Please refresh the page and try again.",contextualColorName:"danger"})})}(t,e),s.canUpdate&&(t.querySelector("#form--assetGroupView fieldset").disabled=!1)},onshown(e,o){var r,n;bulmaJS.toggleHtmlClipped(),bulmaJS.init(e),s.canUpdate&&(t=o,null===(r=e.querySelector("#form--assetGroupView"))||void 0===r||r.addEventListener("submit",g),null===(n=e.querySelector(".is-delete-button"))||void 0===n||n.addEventListener("click",a))},onremoved(){bulmaJS.toggleHtmlClipped()}})}function y(e){var t,s;e.preventDefault(),v(null!==(s=null===(t=e.currentTarget.closest("tr"))||void 0===t?void 0:t.dataset.groupId)&&void 0!==s?s:"")}function f(){var e,t,a,o,r;document.querySelector("#count--assetGroups").textContent=s.assetGroups.length.toString();const n=document.querySelector("#container--assetGroups");if(0===s.assetGroups.length)return void(n.innerHTML='<div class="message is-info">\n        <p class="message-body">\n          <strong>No Asset Groups Found</strong><br />\n          Grouping together assets can assist with reporting on multiple assets.\n        </p>\n        </div>');const l=m.value.trim().toLowerCase().split(" "),i=document.createElement("table");i.className="table is-fullwidth is-striped has-sticky-header",i.innerHTML='<thead><tr>\n      <th>Group</th>\n      <th class="has-text-centered has-width-10">\n        <i class="fas fa-bolt" aria-hidden="true"></i>\n        <span class="is-sr-only">Number of Assets</span>\n      </th>\n      </tr></thead>\n      <tbody></tbody>';e:for(const n of s.assetGroups){const s=n.groupName.toLowerCase()+" "+(null!==(e=n.groupDescription)&&void 0!==e?e:"").toLowerCase();for(const e of l)if(!s.includes(e))continue e;const d=document.createElement("tr");d.dataset.groupId=null!==(a=null===(t=n.groupId)||void 0===t?void 0:t.toString())&&void 0!==a?a:"",d.innerHTML=`<td>\n          <a data-field="groupName" href="#"></a><br />\n          <span class="is-size-7" data-field="groupDescription"></span>\n        </td>\n        <td class="has-width-10 has-text-right">\n          <span class="has-tooltip-left" data-tooltip="Group Members">${null!==(o=n.groupMemberCount)&&void 0!==o?o:0}</span>\n        </td>`;const u=d.querySelector('[data-field="groupName"]');u.textContent=n.groupName,u.addEventListener("click",y),i.querySelector("tbody").append(d),d.querySelector('[data-field="groupDescription"]').textContent=null!==(r=n.groupDescription)&&void 0!==r?r:""}0===i.querySelectorAll("tbody tr").length?n.innerHTML='<div class="message is-info">\n        <p class="message-body">\n          <strong>There are no groups that meet your search criteria.</strong><br />\n          Try to be less specific in your search. \n        </p>\n        </div>':(n.innerHTML="",n.append(i))}null===(t=document.querySelector("#button--addAssetGroup"))||void 0===t||t.addEventListener("click",()=>{let e;function t(t){t.preventDefault(),cityssm.postJSON(s.urlPrefix+"/assets/doAddAssetGroup",t.currentTarget,t=>{const a=t;a.success&&(s.assetGroups=a.assetGroups,f(),e(),v(a.groupId.toString()))})}cityssm.openHtmlModal("assetGroup-add",{onshown(s,a){var o;e=a,bulmaJS.toggleHtmlClipped(),s.querySelector("#assetGroupAdd--groupName").focus(),null===(o=s.querySelector("form"))||void 0===o||o.addEventListener("submit",t)},onremoved(){bulmaJS.toggleHtmlClipped()}})}),bulmaJS.init(),r.addEventListener("keyup",p),o.addEventListener("change",p),p(),m.addEventListener("keyup",f),f()})();