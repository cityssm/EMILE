"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,t;const s=exports.Emile,o=document.querySelector("#filter--categoryId"),a=document.querySelector("#filter--assets");function r(e){e.preventDefault(),cityssm.postJSON(s.urlPrefix+"/assets/doUpdateAsset",e.currentTarget,e=>{var t;const o=e;o.success?(s.assets=o.assets,bulmaJS.alert({message:"Asset updated successfully.",contextualColorName:"success"}),i()):bulmaJS.alert({title:"Error Updating Asset",message:null!==(t=o.errorMessage)&&void 0!==t?t:"Please try again.",contextualColorName:"danger"})})}function n(e){let t;function o(o){o.preventDefault(),bulmaJS.confirm({title:"Delete Asset",message:"Are you sure you want to delete this asset?",contextualColorName:"warning",okButton:{text:"Yes, Delete Asset",callbackFunction:function(){cityssm.postJSON(s.urlPrefix+"/assets/doDeleteAsset",{assetId:e},e=>{var o;const a=e;a.success?(s.assets=a.assets,i(),t()):bulmaJS.alert({title:"Error Deleting Asset",message:null!==(o=a.errorMessage)&&void 0!==o?o:"",contextualColorName:"danger"})})}}})}cityssm.openHtmlModal("asset-view",{onshow(t){!function(e,t){cityssm.postJSON(s.urlPrefix+"/assets/doGetAsset",{assetId:t},t=>{var o,a,r,n,l,i,d,u,c,p,g;const m=t;if(!m.success)return void bulmaJS.alert({title:"Error Loading Asset Details",message:"Please refresh the page and try again.",contextualColorName:"danger"});e.querySelector("#assetView--assetId").value=null!==(a=null===(o=m.asset.assetId)||void 0===o?void 0:o.toString())&&void 0!==a?a:"",e.querySelector('.modal-card-head [data-field="assetName"]').textContent=m.asset.assetName;const v=e.querySelector("#assetView--categoryId");let f=!1;if(s.canUpdate)for(const e of s.assetCategories){const t=document.createElement("option");t.value=null!==(n=null===(r=e.categoryId)||void 0===r?void 0:r.toString())&&void 0!==n?n:"",t.textContent=e.category,e.categoryId===m.asset.categoryId&&(t.selected=!0,f=!0),v.append(t)}if(!f){const e=document.createElement("option");e.value=null!==(i=null===(l=m.asset.categoryId)||void 0===l?void 0:l.toString())&&void 0!==i?i:"",e.textContent=null!==(d=m.asset.category)&&void 0!==d?d:"",e.selected=!0,v.append(e)}e.querySelector("#assetView--assetName").value=m.asset.assetName,e.querySelector("#assetView--latitude").value=null!==(c=null===(u=m.asset.latitude)||void 0===u?void 0:u.toFixed(6))&&void 0!==c?c:"",e.querySelector("#assetView--longitude").value=null!==(g=null===(p=m.asset.longitude)||void 0===p?void 0:p.toFixed(6))&&void 0!==g?g:""})}(t,e),s.canUpdate&&(t.querySelector("#form--assetView fieldset").disabled=!1)},onshown(e,a){var n,l;bulmaJS.toggleHtmlClipped(),bulmaJS.init(e),s.canUpdate&&(t=a,null===(n=e.querySelector("#form--assetView"))||void 0===n||n.addEventListener("submit",r),null===(l=e.querySelector(".is-delete-button"))||void 0===l||l.addEventListener("click",o))},onremoved(){bulmaJS.toggleHtmlClipped()}})}function l(e){var t,s;e.preventDefault(),n(null!==(s=null===(t=e.currentTarget.closest("tr"))||void 0===t?void 0:t.dataset.assetId)&&void 0!==s?s:"")}function i(){var e,t,r,n,i,d,u,c,p,g;document.querySelector("#count--assets").textContent=s.assets.length.toString();const m=document.querySelector("#container--assets");if(0===s.assets.length)return void(m.innerHTML='<div class="message is-warning">\n        <p class="message-body">\n          <strong>No Assets Found</strong><br />\n          Get started by adding some assets that will be reported on.\n        </p>\n        </div>');const v=a.value.trim().toLowerCase().split(" "),f=document.createElement("table");f.className="table is-fullwidth is-striped has-sticky-header",f.innerHTML='<thead><tr>\n      <th class="has-width-10"></th>\n      <th>Category</th>\n      <th>Asset</th>\n      <th class="has-text-centered has-width-10">\n        <i class="far fa-map" aria-hidden="true"></i>\n        <span class="is-sr-only">Map</span>\n      </th>\n      </tr></thead>\n      <tbody></tbody>';e:for(const a of s.assets){if(""!==o.value&&o.value!==(null===(e=a.categoryId)||void 0===e?void 0:e.toString()))continue;const m=a.assetName.toLowerCase()+" "+(null!==(t=a.category)&&void 0!==t?t:"").toLowerCase();for(const e of v)if(!m.includes(e))continue e;const y=document.createElement("tr");y.dataset.assetId=null!==(n=null===(r=a.assetId)||void 0===r?void 0:r.toString())&&void 0!==n?n:"",y.innerHTML=`<td class="has-width-10 has-text-centered">\n        <i class="${null!==(i=a.fontAwesomeIconClasses)&&void 0!==i?i:"fas fa-bolt"}" aria-hidden="true"></i>\n        </td>\n        <td data-field="category"></td>\n        <td><a data-field="assetName" href="#"></a></td>\n        <td class="has-width-10 has-text-centered has-text-nowrap">\n          ${""===(null!==(d=a.latitude)&&void 0!==d?d:"")||""===(null!==(u=a.longitude)&&void 0!==u?u:"")?"":`<a class="has-tooltip-left" data-tooltip="Open Map" href="${s.getMapLink(a.latitude,a.longitude)}" target="_blank" rel="noopener noreferrer" aria-label="Open Map">\n                <i class="fas fa-map-marker-alt" aria-hidden="true"></i>\n                ${null!==(c=a.latitude)&&void 0!==c?c:0}, ${null!==(p=a.longitude)&&void 0!==p?p:0}\n                </a>`}\n        </td>`,y.querySelector('[data-field="category"]').textContent=null!==(g=a.category)&&void 0!==g?g:"";const h=y.querySelector('[data-field="assetName"]');h.textContent=a.assetName,h.addEventListener("click",l),f.querySelector("tbody").append(y)}0===f.querySelectorAll("tbody tr").length?m.innerHTML='<div class="message is-info">\n        <p class="message-body">\n          <strong>There are no assets that meet your search criteria.</strong><br />\n          Try to be less specific in your search. \n        </p>\n        </div>':(m.innerHTML="",m.append(f))}null===(e=document.querySelector("#button--addAsset"))||void 0===e||e.addEventListener("click",()=>{let e;function t(t){t.preventDefault(),cityssm.postJSON(s.urlPrefix+"/assets/doAddAsset",t.currentTarget,t=>{const o=t;o.success&&(s.assets=o.assets,i(),e(),n(o.assetId.toString()))})}cityssm.openHtmlModal("asset-add",{onshow(e){var t,o;const a=e.querySelector("#assetAdd--categoryId");for(const e of s.assetCategories){const s=document.createElement("option");s.value=null!==(o=null===(t=e.categoryId)||void 0===t?void 0:t.toString())&&void 0!==o?o:"",s.textContent=e.category,a.append(s)}},onshown(s,o){var a;e=o,bulmaJS.toggleHtmlClipped(),s.querySelector("#assetAdd--categoryId").focus(),null===(a=s.querySelector("form"))||void 0===a||a.addEventListener("submit",t)},onremoved(){bulmaJS.toggleHtmlClipped()}})});const d=document.querySelector("#filter--assetGroups");function u(e){e.preventDefault(),cityssm.postJSON(s.urlPrefix+"/assets/doUpdateAssetGroup",e.currentTarget,e=>{var t;const o=e;o.success?(s.assetGroups=o.assetGroups,bulmaJS.alert({message:"Asset group updated successfully.",contextualColorName:"success"}),i()):bulmaJS.alert({title:"Error Updating Asset Group",message:null!==(t=o.errorMessage)&&void 0!==t?t:"Please try again.",contextualColorName:"danger"})})}function c(e){let t;function o(o){o.preventDefault(),bulmaJS.confirm({title:"Delete Asset Group",message:"Are you sure you want to delete this group?",contextualColorName:"warning",okButton:{text:"Yes, Delete Asset Group",callbackFunction:function(){cityssm.postJSON(s.urlPrefix+"/assets/doDeleteAssetGroup",{groupId:e},e=>{var o;const a=e;a.success?(s.assetGroups=a.assetGroups,g(),t()):bulmaJS.alert({title:"Error Deleting Asset Group",message:null!==(o=a.errorMessage)&&void 0!==o?o:"",contextualColorName:"danger"})})}}})}cityssm.openHtmlModal("assetGroup-view",{onshow(t){!function(e,t){cityssm.postJSON(s.urlPrefix+"/assets/doGetAssetGroup",{groupId:t},t=>{var s,o;const a=t;a.success?(e.querySelector("#assetGroupView--groupId").value=null!==(o=null===(s=a.assetGroup.groupId)||void 0===s?void 0:s.toString())&&void 0!==o?o:"",e.querySelector('.modal-card-head [data-field="groupName"]').textContent=a.assetGroup.groupName,e.querySelector("#assetGroupView--groupName").value=a.assetGroup.groupName,e.querySelector("#assetGroupView--isShared").value=a.assetGroup.isShared?"1":"0",e.querySelector("#assetGroupView--groupDescription").value=a.assetGroup.groupDescription):bulmaJS.alert({title:"Error Loading Asset Group Details",message:"Please refresh the page and try again.",contextualColorName:"danger"})})}(t,e),s.canUpdate&&(t.querySelector("#form--assetGroupView fieldset").disabled=!1)},onshown(e,a){var r,n;bulmaJS.toggleHtmlClipped(),bulmaJS.init(e),s.canUpdate&&(t=a,null===(r=e.querySelector("#form--assetGroupView"))||void 0===r||r.addEventListener("submit",u),null===(n=e.querySelector(".is-delete-button"))||void 0===n||n.addEventListener("click",o))},onremoved(){bulmaJS.toggleHtmlClipped()}})}function p(e){var t,s;e.preventDefault(),c(null!==(s=null===(t=e.currentTarget.closest("tr"))||void 0===t?void 0:t.dataset.groupId)&&void 0!==s?s:"")}function g(){var e,t,o,a,r;document.querySelector("#count--assetGroups").textContent=s.assetGroups.length.toString();const n=document.querySelector("#container--assetGroups");if(0===s.assetGroups.length)return void(n.innerHTML='<div class="message is-info">\n        <p class="message-body">\n          <strong>No Asset Groups Found</strong><br />\n          Grouping together assets can assist with reporting on multiple assets.\n        </p>\n        </div>');const l=d.value.trim().toLowerCase().split(" "),i=document.createElement("table");i.className="table is-fullwidth is-striped has-sticky-header",i.innerHTML='<thead><tr>\n      <th>Group</th>\n      <th class="has-text-centered has-width-10">\n        <i class="fas fa-bolt" aria-hidden="true"></i>\n        <span class="is-sr-only">Number of Assets</span>\n      </th>\n      </tr></thead>\n      <tbody></tbody>';e:for(const n of s.assetGroups){const s=n.groupName.toLowerCase()+" "+(null!==(e=n.groupDescription)&&void 0!==e?e:"").toLowerCase();for(const e of l)if(!s.includes(e))continue e;const d=document.createElement("tr");d.dataset.groupId=null!==(o=null===(t=n.groupId)||void 0===t?void 0:t.toString())&&void 0!==o?o:"",d.innerHTML=`<td>\n          <a data-field="groupName" href="#"></a><br />\n          <span class="is-size-7" data-field="groupDescription"></span>\n        </td>\n        <td class="has-width-10 has-text-right">\n          <span class="has-tooltip-left" data-tooltip="Group Members">${null!==(a=n.groupMemberCount)&&void 0!==a?a:0}</span>\n        </td>`;const u=d.querySelector('[data-field="groupName"]');u.textContent=n.groupName,u.addEventListener("click",p),i.querySelector("tbody").append(d),d.querySelector('[data-field="groupDescription"]').textContent=null!==(r=n.groupDescription)&&void 0!==r?r:""}0===i.querySelectorAll("tbody tr").length?n.innerHTML='<div class="message is-info">\n        <p class="message-body">\n          <strong>There are no groups that meet your search criteria.</strong><br />\n          Try to be less specific in your search. \n        </p>\n        </div>':(n.innerHTML="",n.append(i))}null===(t=document.querySelector("#button--addAssetGroup"))||void 0===t||t.addEventListener("click",()=>{let e;function t(t){t.preventDefault(),cityssm.postJSON(s.urlPrefix+"/assets/doAddAssetGroup",t.currentTarget,t=>{const o=t;o.success&&(s.assetGroups=o.assetGroups,g(),e(),c(o.groupId.toString()))})}cityssm.openHtmlModal("assetGroup-add",{onshown(s,o){var a;e=o,bulmaJS.toggleHtmlClipped(),s.querySelector("#assetGroupAdd--groupName").focus(),null===(a=s.querySelector("form"))||void 0===a||a.addEventListener("submit",t)},onremoved(){bulmaJS.toggleHtmlClipped()}})}),bulmaJS.init(),a.addEventListener("keyup",i),o.addEventListener("change",i),i(),d.addEventListener("keyup",g),g()})();