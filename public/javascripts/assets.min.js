"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,t;const s=exports.Emile,o=exports.assetCategories;delete exports.assetCategories;let a=exports.assets;delete exports.assets;const r=document.querySelector("#filter--categoryId"),n=document.querySelector("#filter--assets");function l(e){e.preventDefault(),cityssm.postJSON(s.urlPrefix+"/assets/doUpdateAsset",e.currentTarget,e=>{var t;const s=e;s.success?(a=s.assets,bulmaJS.alert({message:"Asset updated successfully.",contextualColorName:"success"}),u()):bulmaJS.alert({title:"Error Updating Asset",message:null!==(t=s.errorMessage)&&void 0!==t?t:"Please try again.",contextualColorName:"danger"})})}function i(e){let t;function r(o){o.preventDefault(),bulmaJS.confirm({title:"Delete Asset",message:"Are you sure you want to delete this asset?",contextualColorName:"warning",okButton:{text:"Yes, Delete Asset",callbackFunction:function(){cityssm.postJSON(s.urlPrefix+"/assets/doDeleteAsset",{assetId:e},e=>{var s;const o=e;o.success?(a=o.assets,u(),t()):bulmaJS.alert({title:"Error Deleting Asset",message:null!==(s=o.errorMessage)&&void 0!==s?s:"",contextualColorName:"danger"})})}}})}cityssm.openHtmlModal("asset-view",{onshow(t){!function(e,t){cityssm.postJSON(s.urlPrefix+"/assets/doGetAsset",{assetId:t},t=>{var a,r,n,l,i,d,u,c,p,g,m;const v=t;if(!v.success)return void bulmaJS.alert({title:"Error Loading Asset Details",message:"Please refresh the page and try again.",contextualColorName:"danger"});e.querySelector("#assetView--assetId").value=null!==(r=null===(a=v.asset.assetId)||void 0===a?void 0:a.toString())&&void 0!==r?r:"",e.querySelector('.modal-card-head [data-field="assetName"]').textContent=v.asset.assetName;const y=e.querySelector("#assetView--categoryId");let f=!1;if(s.canUpdate)for(const e of o){const t=document.createElement("option");t.value=null!==(l=null===(n=e.categoryId)||void 0===n?void 0:n.toString())&&void 0!==l?l:"",t.textContent=e.category,e.categoryId===v.asset.categoryId&&(t.selected=!0,f=!0),y.append(t)}if(!f){const e=document.createElement("option");e.value=null!==(d=null===(i=v.asset.categoryId)||void 0===i?void 0:i.toString())&&void 0!==d?d:"",e.textContent=null!==(u=v.asset.category)&&void 0!==u?u:"",e.selected=!0,y.append(e)}e.querySelector("#assetView--assetName").value=v.asset.assetName,e.querySelector("#assetView--latitude").value=null!==(p=null===(c=v.asset.latitude)||void 0===c?void 0:c.toFixed(6))&&void 0!==p?p:"",e.querySelector("#assetView--longitude").value=null!==(m=null===(g=v.asset.longitude)||void 0===g?void 0:g.toFixed(6))&&void 0!==m?m:""})}(t,e),s.canUpdate&&(t.querySelector("#form--assetView fieldset").disabled=!1)},onshown(e,o){var a,n;bulmaJS.toggleHtmlClipped(),bulmaJS.init(e),s.canUpdate&&(t=o,null===(a=e.querySelector("#form--assetView"))||void 0===a||a.addEventListener("submit",l),null===(n=e.querySelector(".is-delete-button"))||void 0===n||n.addEventListener("click",r))},onremoved(){bulmaJS.toggleHtmlClipped()}})}function d(e){var t,s;e.preventDefault(),i(null!==(s=null===(t=e.currentTarget.closest("tr"))||void 0===t?void 0:t.dataset.assetId)&&void 0!==s?s:"")}function u(){var e,t,o,l,i,u,c,p;document.querySelector("#count--assets").textContent=a.length.toString();const g=document.querySelector("#container--assets");if(0===a.length)return void(g.innerHTML='<div class="message is-warning">\n        <p class="message-body">\n          <strong>No Assets Found</strong><br />\n          Get started by adding some assets that will be reported on.\n        </p>\n        </div>');const m=n.value.trim().toLowerCase().split(" "),v=document.createElement("table");v.className="table is-fullwidth is-striped has-sticky-header",v.innerHTML='<thead><tr>\n      <th class="has-width-10"></th>\n      <th>Category</th>\n      <th>Asset</th>\n      <th class="has-text-centered has-width-10">\n        <i class="far fa-map" aria-hidden="true"></i>\n        <span class="is-sr-only">Map</span>\n      </th>\n      </tr></thead>\n      <tbody></tbody>';e:for(const n of a){if(""!==r.value&&r.value!==(null===(e=n.categoryId)||void 0===e?void 0:e.toString()))continue;const a=n.assetName.toLowerCase()+" "+(null!==(t=n.category)&&void 0!==t?t:"").toLowerCase();for(const e of m)if(!a.includes(e))continue e;const g=document.createElement("tr");g.dataset.assetId=null!==(l=null===(o=n.assetId)||void 0===o?void 0:o.toString())&&void 0!==l?l:"",g.innerHTML=`<td class="has-width-10 has-text-centered">\n        <i class="${null!==(i=n.fontAwesomeIconClasses)&&void 0!==i?i:"fas fa-bolt"}" aria-hidden="true"></i>\n        </td>\n        <td data-field="category"></td>\n        <td><a data-field="assetName" href="#"></a></td>\n        <td class="has-width-10 has-text-centered">\n          ${""===(null!==(u=n.latitude)&&void 0!==u?u:"")||""===(null!==(c=n.longitude)&&void 0!==c?c:"")?"":`<a class="has-tooltip-left" data-tooltip="Open Map" href="${s.getMapLink(n.latitude,n.longitude)}" target="_blank" rel="noopener noreferrer" aria-label="Open Map">\n                <i class="fas fa-map-marker-alt" aria-hidden="true"></i>\n                </a>`}\n        </td>`,g.querySelector('[data-field="category"]').textContent=null!==(p=n.category)&&void 0!==p?p:"";const y=g.querySelector('[data-field="assetName"]');y.textContent=n.assetName,y.addEventListener("click",d),v.querySelector("tbody").append(g)}0===v.querySelectorAll("tbody tr").length?g.innerHTML='<div class="message is-info">\n        <p class="message-body">\n          <strong>There are no assets that meet your search criteria.</strong><br />\n          Try to be less specific in your search. \n        </p>\n        </div>':(g.innerHTML="",g.append(v))}null===(e=document.querySelector("#button--addAsset"))||void 0===e||e.addEventListener("click",()=>{let e;function t(t){t.preventDefault(),cityssm.postJSON(s.urlPrefix+"/assets/doAddAsset",t.currentTarget,t=>{const s=t;s.success&&(a=s.assets,u(),e(),i(s.assetId.toString()))})}cityssm.openHtmlModal("asset-add",{onshow(e){var t,s;const a=e.querySelector("#assetAdd--categoryId");for(const e of o){const o=document.createElement("option");o.value=null!==(s=null===(t=e.categoryId)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",o.textContent=e.category,a.append(o)}},onshown(s,o){var a;e=o,bulmaJS.toggleHtmlClipped(),s.querySelector("#assetAdd--categoryId").focus(),null===(a=s.querySelector("form"))||void 0===a||a.addEventListener("submit",t)},onremoved(){bulmaJS.toggleHtmlClipped()}})});let c=exports.assetGroups;delete exports.assetGroups;const p=document.querySelector("#filter--assetGroups");function g(e){e.preventDefault(),cityssm.postJSON(s.urlPrefix+"/assets/doUpdateAssetGroup",e.currentTarget,e=>{var t;const s=e;s.success?(c=s.assetGroups,bulmaJS.alert({message:"Asset group updated successfully.",contextualColorName:"success"}),u()):bulmaJS.alert({title:"Error Updating Asset Group",message:null!==(t=s.errorMessage)&&void 0!==t?t:"Please try again.",contextualColorName:"danger"})})}function m(e){let t;function o(o){o.preventDefault(),bulmaJS.confirm({title:"Delete Asset Group",message:"Are you sure you want to delete this group?",contextualColorName:"warning",okButton:{text:"Yes, Delete Asset Group",callbackFunction:function(){cityssm.postJSON(s.urlPrefix+"/assets/doDeleteAssetGroup",{groupId:e},e=>{var s;const o=e;o.success?(c=o.assetGroups,y(),t()):bulmaJS.alert({title:"Error Deleting Asset Group",message:null!==(s=o.errorMessage)&&void 0!==s?s:"",contextualColorName:"danger"})})}}})}cityssm.openHtmlModal("assetGroup-view",{onshow(t){!function(e,t){cityssm.postJSON(s.urlPrefix+"/assets/doGetAssetGroup",{groupId:t},t=>{var s,o;const a=t;a.success?(e.querySelector("#assetGroupView--groupId").value=null!==(o=null===(s=a.assetGroup.groupId)||void 0===s?void 0:s.toString())&&void 0!==o?o:"",e.querySelector('.modal-card-head [data-field="groupName"]').textContent=a.assetGroup.groupName,e.querySelector("#assetGroupView--groupName").value=a.assetGroup.groupName,e.querySelector("#assetGroupView--isShared").value=a.assetGroup.isShared?"1":"0",e.querySelector("#assetGroupView--groupDescription").value=a.assetGroup.groupDescription):bulmaJS.alert({title:"Error Loading Asset Group Details",message:"Please refresh the page and try again.",contextualColorName:"danger"})})}(t,e),s.canUpdate&&(t.querySelector("#form--assetGroupView fieldset").disabled=!1)},onshown(e,a){var r,n;bulmaJS.toggleHtmlClipped(),bulmaJS.init(e),s.canUpdate&&(t=a,null===(r=e.querySelector("#form--assetGroupView"))||void 0===r||r.addEventListener("submit",g),null===(n=e.querySelector(".is-delete-button"))||void 0===n||n.addEventListener("click",o))},onremoved(){bulmaJS.toggleHtmlClipped()}})}function v(e){var t,s;e.preventDefault(),m(null!==(s=null===(t=e.currentTarget.closest("tr"))||void 0===t?void 0:t.dataset.groupId)&&void 0!==s?s:"")}function y(){var e,t,s,o,a;document.querySelector("#count--assetGroups").textContent=c.length.toString();const r=document.querySelector("#container--assetGroups");if(0===c.length)return void(r.innerHTML='<div class="message is-info">\n        <p class="message-body">\n          <strong>No Asset Groups Found</strong><br />\n          Grouping together assets can assist with reporting on multiple assets.\n        </p>\n        </div>');const n=p.value.trim().toLowerCase().split(" "),l=document.createElement("table");l.className="table is-fullwidth is-striped has-sticky-header",l.innerHTML='<thead><tr>\n      <th>Group</th>\n      <th class="has-text-centered has-width-10">\n        <i class="fas fa-city" aria-hidden="true"></i>\n        <span class="is-sr-only">Number of Assets</span>\n      </th>\n      </tr></thead>\n      <tbody></tbody>';e:for(const r of c){const i=r.groupName.toLowerCase()+" "+(null!==(e=r.groupDescription)&&void 0!==e?e:"").toLowerCase();for(const e of n)if(!i.includes(e))continue e;const d=document.createElement("tr");d.dataset.groupId=null!==(s=null===(t=r.groupId)||void 0===t?void 0:t.toString())&&void 0!==s?s:"",d.innerHTML=`<td>\n          <a data-field="groupName" href="#"></a><br />\n          <span class="is-size-7" data-field="groupDescription"></span>\n        </td>\n        <td class="has-width-10 has-text-right">\n          <span class="has-tooltip-left" data-tooltip="Group Members">${null!==(o=r.groupMemberCount)&&void 0!==o?o:0}</span>\n        </td>`;const u=d.querySelector('[data-field="groupName"]');u.textContent=r.groupName,u.addEventListener("click",v),l.querySelector("tbody").append(d),d.querySelector('[data-field="groupDescription"]').textContent=null!==(a=r.groupDescription)&&void 0!==a?a:""}0===l.querySelectorAll("tbody tr").length?r.innerHTML='<div class="message is-info">\n        <p class="message-body">\n          <strong>There are no groups that meet your search criteria.</strong><br />\n          Try to be less specific in your search. \n        </p>\n        </div>':(r.innerHTML="",r.append(l))}null===(t=document.querySelector("#button--addAssetGroup"))||void 0===t||t.addEventListener("click",()=>{let e;function t(t){t.preventDefault(),cityssm.postJSON(s.urlPrefix+"/assets/doAddAssetGroup",t.currentTarget,t=>{const s=t;s.success&&(c=s.assetGroups,y(),e(),m(s.groupId.toString()))})}cityssm.openHtmlModal("assetGroup-add",{onshown(s,o){var a;e=o,bulmaJS.toggleHtmlClipped(),s.querySelector("#assetGroupAdd--groupName").focus(),null===(a=s.querySelector("form"))||void 0===a||a.addEventListener("submit",t)},onremoved(){bulmaJS.toggleHtmlClipped()}})}),bulmaJS.init(),n.addEventListener("keyup",u),r.addEventListener("change",u),u(),p.addEventListener("keyup",y),y()})();