"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e;const t=exports.Emile,s=exports.assetAliasTypes,a=document.querySelector("#filter--categoryId"),n=document.querySelector("#filter--assets");function o(e){const s=e.currentTarget.closest("tr"),a=s.dataset.aliasId,n=s.dataset.assetId;bulmaJS.confirm({title:"Delete Asset Alias",message:"Are you sure you want to remove this asset alias?",contextualColorName:"warning",okButton:{text:"Yes, Remove Alias",callbackFunction:function(){cityssm.postJSON(`${t.urlPrefix}/assets/doDeleteAssetAlias`,{aliasId:a,assetId:n},e=>{var t;const s=e;s.success?l(s.assetAliases):bulmaJS.alert({title:"Error Deleting Alias",message:null!==(t=s.errorMessage)&&void 0!==t?t:"Please try again.",contextualColorName:"danger"})})}}})}function l(e){var s,a,n;const l=document.querySelector(".modal #tbody--assetAliases");l.innerHTML="";for(const r of e){const e=document.createElement("tr");e.dataset.aliasId=r.aliasId.toString(),e.dataset.assetId=r.assetId.toString(),e.innerHTML=`<td data-field="aliasType"></td>\n        <td data-field="assetAlias"></td>\n        <td>\n          ${t.canUpdate?'<button class="button is-danger is-delete-button" type="button">\n                  <span class="icon"><i class="fas fa-trash" aria-hidden="true"></i></span>\n                  <span>Delete Alias</span>\n                  </button>':""}\n        </td>`,e.querySelector('[data-field="aliasType"]').textContent=null!==(s=r.aliasType)&&void 0!==s?s:"",e.querySelector('[data-field="assetAlias"]').textContent=null!==(a=r.assetAlias)&&void 0!==a?a:"",null===(n=e.querySelector(".is-delete-button"))||void 0===n||n.addEventListener("click",o),l.append(e)}}function r(e){e.preventDefault(),cityssm.postJSON(`${t.urlPrefix}/assets/doUpdateAsset`,e.currentTarget,e=>{var s;const a=e;a.success?(t.assets=a.assets,bulmaJS.alert({message:"Asset updated successfully.",contextualColorName:"success"}),m()):bulmaJS.alert({title:"Error Updating Asset",message:null!==(s=a.errorMessage)&&void 0!==s?s:"Please try again.",contextualColorName:"danger"})})}function d(e){e.preventDefault();const s=e.currentTarget;cityssm.postJSON(`${t.urlPrefix}/assets/doAddAssetAlias`,s,e=>{var t;const a=e;a.success?(l(a.assetAliases),s.reset()):bulmaJS.alert({title:"Error Adding Alias",message:null!==(t=a.errorMessage)&&void 0!==t?t:"Please try again.",contextualColorName:"danger"})})}function i(e){let a;function n(s){s.preventDefault(),bulmaJS.confirm({title:"Delete Asset",message:"Are you sure you want to delete this asset?",contextualColorName:"warning",okButton:{text:"Yes, Delete Asset",callbackFunction:function(){cityssm.postJSON(`${t.urlPrefix}/assets/doDeleteAsset`,{assetId:e},e=>{var s;const n=e;n.success?(t.assets=n.assets,m(),a()):bulmaJS.alert({title:"Error Deleting Asset",message:null!==(s=n.errorMessage)&&void 0!==s?s:"",contextualColorName:"danger"})})}}})}cityssm.openHtmlModal("asset-view",{onshow(a){var n;if(function(e,s){cityssm.postJSON(`${t.urlPrefix}/assets/doGetAsset`,{assetId:s},s=>{var a,n,o,r,d,i,c,u,v,g,m,p;const y=s;if(!y.success)return void bulmaJS.alert({title:"Error Loading Asset Details",message:"Please refresh the page and try again.",contextualColorName:"danger"});e.querySelector("#assetView--assetId").value=null!==(n=null===(a=y.asset.assetId)||void 0===a?void 0:a.toString())&&void 0!==n?n:"",e.querySelector('.modal-card-head [data-field="assetName"]').textContent=y.asset.assetName;const f=e.querySelector("#assetView--categoryId");let S=!1;if(t.canUpdate)for(const e of t.assetCategories){const t=document.createElement("option");t.value=null!==(r=null===(o=e.categoryId)||void 0===o?void 0:o.toString())&&void 0!==r?r:"",t.textContent=e.category,e.categoryId===y.asset.categoryId&&(t.selected=!0,S=!0),f.append(t)}if(!S){const e=document.createElement("option");e.value=null!==(i=null===(d=y.asset.categoryId)||void 0===d?void 0:d.toString())&&void 0!==i?i:"",e.textContent=null!==(c=y.asset.category)&&void 0!==c?c:"",e.selected=!0,f.append(e)}e.querySelector("#assetView--assetName").value=y.asset.assetName,e.querySelector("#assetView--latitude").value=null!==(v=null===(u=y.asset.latitude)||void 0===u?void 0:u.toFixed(6))&&void 0!==v?v:"",e.querySelector("#assetView--longitude").value=null!==(m=null===(g=y.asset.longitude)||void 0===g?void 0:g.toFixed(6))&&void 0!==m?m:"",l(null!==(p=y.asset.assetAliases)&&void 0!==p?p:[])})}(a,e),t.canUpdate){a.querySelector("#form--assetView fieldset").disabled=!1,a.querySelector("#assetAliasAdd--assetId").value=e;const t=a.querySelector("#assetAliasAdd--aliasTypeId");for(const e of s){const s=document.createElement("option");s.value=e.aliasTypeId.toString(),s.textContent=e.aliasType,t.append(s)}}else null===(n=a.querySelector("#tbody--assetAliasAdd"))||void 0===n||n.remove()},onshown(e,t){var s,o,l;bulmaJS.toggleHtmlClipped(),bulmaJS.init(e),a=t,null===(s=e.querySelector("#form--assetView"))||void 0===s||s.addEventListener("submit",r),null===(o=e.querySelector(".is-delete-button"))||void 0===o||o.addEventListener("click",n),null===(l=e.querySelector("#form--assetAliasAdd"))||void 0===l||l.addEventListener("submit",d)},onremoved(){bulmaJS.toggleHtmlClipped()}})}function c(e){var t,s;e.preventDefault(),i(null!==(s=null===(t=e.currentTarget.closest("tr"))||void 0===t?void 0:t.dataset.assetId)&&void 0!==s?s:"")}const u=document.querySelector("#button--mergeAssets"),v=document.querySelector("#container--assets");function g(){null!==u&&(u.disabled=v.querySelectorAll("input.selectedAssetId:checked").length<2)}function m(){var e,s,o,l,r,d,i,u,m,p,y,f,S;if(document.querySelector("#count--assets").textContent=t.assets.length.toString(),v.innerHTML="",g(),0===t.assets.length)return void(v.innerHTML='<div class="message is-warning">\n        <p class="message-body">\n          <strong>No Assets Found</strong><br />\n          Get started by adding some assets that will be reported on.\n        </p>\n        </div>');const h=n.value.trim().toLowerCase().split(" "),A=document.createElement("table");A.className="table is-fullwidth is-striped has-sticky-header is-fade-hoverable",A.innerHTML=`<thead><tr>\n      ${t.canUpdate?'<th class="has-width-10"><span class="is-sr-only">Select</span></th>':""}\n      <th class="has-width-10"><span class="is-sr-only">Icon</span></th>\n      <th>Category</th>\n      <th>Asset</th>\n      <th>Data From</th>\n      <th>Data To</th>\n      <th class="has-text-centered has-width-10">\n        <i class="far fa-map" aria-hidden="true"></i>\n        <span class="is-sr-only">Map</span>\n      </th>\n      </tr></thead>\n      <tbody></tbody>`;e:for(const n of t.assets){if(""!==a.value&&a.value!==(null===(e=n.categoryId)||void 0===e?void 0:e.toString()))continue;const v=`${n.assetName} ${null!==(s=n.category)&&void 0!==s?s:""}`.toLowerCase();for(const e of h)if(!v.includes(e))continue e;const b=document.createElement("tr");b.dataset.assetId=null!==(l=null===(o=n.assetId)||void 0===o?void 0:o.toString())&&void 0!==l?l:"",t.canUpdate&&(b.innerHTML=`<td class="has-width-10 has-text-centered">\n          <input class="selectedAssetId" id="selectedAssetId_${n.assetId}" type="checkbox" value="${n.assetId}" />\n          </td>`);const x=new Date(1e3*(null!==(r=n.endTimeSecondsMax)&&void 0!==r?r:0)),I=null===n.endTimeSecondsMax||Date.now()-x.getTime()>=27648e5;b.insertAdjacentHTML("beforeend",`<td class="has-width-10 has-text-centered">\n        <i class="${null!==(d=n.fontAwesomeIconClasses)&&void 0!==d?d:"fas fa-bolt"}" aria-hidden="true"></i>\n        </td>\n        <td data-field="category"></td>\n        <td><a data-field="assetName" href="#"></a></td>\n        <td>\n          ${null===n.timeSecondsMin?'<span class="has-text-grey">(No Data)</span>':new Date(1e3*(null!==(i=n.timeSecondsMin)&&void 0!==i?i:0)).toLocaleString()}\n        </td>\n        <td ${I?' class="has-background-warning" title="Past Date"':""}>\n          ${null===n.endTimeSecondsMax?"":x.toLocaleString()}\n        </td>\n        <td class="has-width-10 has-text-centered has-text-nowrap">\n          ${""===(null!==(u=n.latitude)&&void 0!==u?u:"")||""===(null!==(m=n.longitude)&&void 0!==m?m:"")?"":`<a class="has-tooltip-left" data-tooltip="Open Map" href="${t.getMapLink(n.latitude,n.longitude)}" target="_blank" rel="noopener noreferrer" aria-label="Open Map">\n                <i class="fas fa-map-marker-alt" aria-hidden="true"></i>\n                ${null!==(p=n.latitude)&&void 0!==p?p:0}, ${null!==(y=n.longitude)&&void 0!==y?y:0}\n                </a>`}\n        </td>`),b.querySelector('[data-field="category"]').textContent=null!==(f=n.category)&&void 0!==f?f:"";const q=b.querySelector('[data-field="assetName"]');q.textContent=n.assetName,q.addEventListener("click",c),null===(S=b.querySelector("input"))||void 0===S||S.addEventListener("change",g),A.querySelector("tbody").append(b)}0===A.querySelectorAll("tbody tr").length?v.innerHTML='<div class="message is-info">\n        <p class="message-body">\n          <strong>There are no assets that meet your search criteria.</strong><br />\n          Try to be less specific in your search. \n        </p>\n        </div>':v.append(A)}null==u||u.addEventListener("click",()=>{var e,s;const a=v.querySelectorAll("input.selectedAssetId:checked"),n=[];for(const e of a)n.push(e.value);const o=[];for(const a of t.assets)n.includes(null!==(s=null===(e=a.assetId)||void 0===e?void 0:e.toString())&&void 0!==s?s:"")&&o.push(a);let l;function r(e){e.preventDefault(),cityssm.postJSON(`${t.urlPrefix}/assets/doMergeAssets`,e.currentTarget,e=>{const s=e;s.success&&(l(),t.assets=s.assets,m(),i(s.assetId.toString()))})}cityssm.openHtmlModal("asset-merge",{onshow(e){var t,s,a,l,r,d,i,c,u,v,g,m,p;e.querySelector("#assetMerge--assetIds").value=n.join(",");const y=e.querySelector("#assetMerge--categoryId"),f=e.querySelector("#assetMerge--assetName"),S=e.querySelector("#assetMerge--latitudeLongitude");for(const e of o){const n=document.createElement("option");n.textContent=null!==(t=e.category)&&void 0!==t?t:"",n.value=null!==(a=null===(s=e.categoryId)||void 0===s?void 0:s.toString())&&void 0!==a?a:"",y.append(n);const o=document.createElement("option");if(o.textContent=e.assetName,o.value=e.assetName,f.append(o),void 0!==(null!==(l=e.latitude)&&void 0!==l?l:void 0)||void 0!==(null!==(r=e.longitude)&&void 0!==r?r:void 0)){const t=document.createElement("option");t.textContent=`${null!==(i=null===(d=e.latitude)||void 0===d?void 0:d.toString())&&void 0!==i?i:""}, ${null!==(u=null===(c=e.longitude)||void 0===c?void 0:c.toString())&&void 0!==u?u:""}`,t.value=`${null!==(g=null===(v=e.latitude)||void 0===v?void 0:v.toString())&&void 0!==g?g:""}::${null!==(p=null===(m=e.longitude)||void 0===m?void 0:m.toString())&&void 0!==p?p:""}`,S.append(t)}}},onshown(e,t){var s;bulmaJS.toggleHtmlClipped(),l=t,e.querySelector("#assetMerge--categoryId").focus(),null===(s=e.querySelector("form"))||void 0===s||s.addEventListener("submit",r)},onremoved(){bulmaJS.toggleHtmlClipped()}})}),null===(e=document.querySelector("#button--addAsset"))||void 0===e||e.addEventListener("click",()=>{let e;function s(s){s.preventDefault(),cityssm.postJSON(`${t.urlPrefix}/assets/doAddAsset`,s.currentTarget,s=>{const a=s;a.success&&(t.assets=a.assets,m(),e(),i(a.assetId.toString()))})}cityssm.openHtmlModal("asset-add",{onshow(e){var s,a;const n=e.querySelector("#assetAdd--categoryId");for(const e of t.assetCategories){const t=document.createElement("option");t.value=null!==(a=null===(s=e.categoryId)||void 0===s?void 0:s.toString())&&void 0!==a?a:"",t.textContent=e.category,n.append(t)}},onshown(t,a){var n;e=a,bulmaJS.toggleHtmlClipped(),t.querySelector("#assetAdd--categoryId").focus(),null===(n=t.querySelector("form"))||void 0===n||n.addEventListener("submit",s)},onremoved(){bulmaJS.toggleHtmlClipped()}})}),n.addEventListener("keyup",m),a.addEventListener("change",m),m()})();