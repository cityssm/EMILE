"use strict";var __awaiter=this&&this.__awaiter||function(e,t,n,s){return new(n||(n=Promise))(function(a,i){function r(e){try{o(s.next(e))}catch(e){i(e)}}function l(e){try{o(s.throw(e))}catch(e){i(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(r,l)}o((s=s.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,t;const n=exports.Emile;let s=exports.pendingFiles;function a(e){var t,n;const a=Number.parseInt(null!==(n=null===(t=e.currentTarget.closest("tr"))||void 0===t?void 0:t.dataset.fileId)&&void 0!==n?n:"",10);s.find(e=>e.fileId===a);cityssm.openHtmlModal("data-parserSettings",{})}function i(){var e,t,n,i,r,l,o,d,c,u;const p=document.querySelector("#count--pendingFiles"),f=document.querySelector("#container--pendingFiles");if(p.textContent=s.length.toString(),0===s.length)return void(f.innerHTML='<div class="message is-info">\n        <p class="message-body">There are no pending files that require attention.</p>\n        </div>');const v=document.createElement("table");v.className="table is-fullwidth is-striped is-hoverable has-sticky-header",v.innerHTML='<thead><tr>\n      <th>Pending File</th>\n      <th>Parser Settings</th>\n      <th><span class="is-sr-only">Options</span></th>\n      </tr></thead>\n      <tbody></tbody>';for(const p of s){const s=document.createElement("tr");s.dataset.fileId=null===(e=p.fileId)||void 0===e?void 0:e.toString();const f=new Date(p.recordCreate_timeMillis);s.innerHTML=`<td>\n          <span class="has-text-weight-bold" data-field="originalFileName"></span><br />\n          <span class="is-size-7">Uploaded ${f.toISOString()}</span>\n        </td>\n        <td class="is-size-7">\n          <span data-field="assetName">${null===p.assetId?'<i class="fas fa-fw fa-hat-wizard" aria-hidden="true"></i> Detect Asset from File':""}</span><br />\n          <span>\n            <i class="fas fa-fw fa-cog" aria-hidden="true"></i>\n            ${""===(null!==(n=null===(t=p.parserProperties)||void 0===t?void 0:t.parserClass)&&void 0!==n?n:"")?"No Parser Selected":null!==(r=null===(i=p.parserProperties)||void 0===i?void 0:i.parserClass)&&void 0!==r?r:""}\n          </span>\n        </td>\n        <td class="has-text-right">\n          <button class="button is-info is-settings-button" type="button">\n            <span class="icon"><i class="fas fa-pencil-alt" aria-hidden="true"></i></span>\n            <span>Settings</span>\n          </button>\n          <button class="button is-success is-parse-button" type="button" ${""===(null!==(o=null===(l=p.parserProperties)||void 0===l?void 0:l.parserClass)&&void 0!==o?o:"")?"disabled":""}>\n            <span class="icon"><i class="fas fa-cogs" aria-hidden="true"></i></span>\n            <span>Parse File</span>\n          </button>\n          <button class="button is-danger is-light is-delete-button" type="button" aria-label="Delete File">\n            <i class="fas fa-trash" aria-hidden="true"></i>\n          </button>\n        </td>`,null!==p.assetId&&(s.querySelector('[data-field="assetName"]').textContent=null!==(d=p.assetName)&&void 0!==d?d:""),s.querySelector('[data-field="originalFileName"]').textContent=p.originalFileName,null===(c=s.querySelector(".is-settings-button"))||void 0===c||c.addEventListener("click",a),null===(u=v.querySelector("tbody"))||void 0===u||u.append(s)}f.innerHTML="",f.append(v)}delete exports.pendingFiles,i();let r=exports.failedFiles;delete exports.failedFiles;const l=null!==(t=null===(e=document.querySelector("meta[name='csrf-token']"))||void 0===e?void 0:e.getAttribute("content"))&&void 0!==t?t:"",o=document.querySelector("#upload--dropZone"),d=["has-background-success-light","has-text-success"];o.addEventListener("dragover",e=>{e.preventDefault(),o.classList.add(...d)}),o.addEventListener("dragleave",e=>{e.preventDefault(),o.classList.remove(...d)}),o.addEventListener("drop",e=>{var t,a;e.preventDefault();const c=new FormData;if(void 0!==(null===(t=e.dataTransfer)||void 0===t?void 0:t.items)){for(const t of e.dataTransfer.items)if("file"===t.kind){const e=t.getAsFile();c.append("file",e)}}else if(void 0!==(null===(a=e.dataTransfer)||void 0===a?void 0:a.files))for(const t of e.dataTransfer.files)c.append("file",t);fetch(n.urlPrefix+"/data/doUploadDataFiles",{credentials:"same-origin",headers:{"CSRF-Token":l},method:"POST",body:c}).then(e=>__awaiter(void 0,void 0,void 0,function*(){return yield e.json()})).then(e=>(e.success&&(s=e.pendingFiles,i(),r=e.failedFiles),e.success)).catch(()=>{bulmaJS.alert({message:"Error processing files.",contextualColorName:"danger"})}),o.classList.remove(...d)}),bulmaJS.init()})();