"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),(()=>{var e,a;const t=exports.Emile;let s=exports.backupFiles;function n(e){var a,n;const o=null!==(n=null===(a=e.currentTarget.closest("tr"))||void 0===a?void 0:a.dataset.fileName)&&void 0!==n?n:"";bulmaJS.confirm({title:"Delete Backup File",message:"Are you sure you want to delete this backed up database file?",contextualColorName:"warning",okButton:{text:"Yes, Delete Backup File",callbackFunction:function(){cityssm.postJSON(`${t.urlPrefix}/admin/doDeleteBackupFile`,{fileName:o},e=>{const a=e;a.success?(s=a.backupFiles,bulmaJS.alert({message:"Database backup deleted up successfully.",contextualColorName:"success"}),l()):bulmaJS.alert({title:"Error Deleting Backup File",message:"Please try again.",contextualColorName:"danger"})})}}})}function l(){var e,a;const l=document.querySelector("#container--backupFiles");if(0!==s.length){l.innerHTML='<table class="table is-fullwidth is-striped is-hoverable has-sticky-header">\n      <thead><tr>\n        <th>Backup File Name</th>\n        <th>Last Modified</th>\n        <th class="has-text-right">File Size</th>\n        <th class="has-width-10"><span class="is-sr-only">Options</span></td>\n      </tr></thead>\n      <tbody></tbody>\n      </table>';for(const o of s){const s=document.createElement("tr");s.dataset.fileName=o.fileName,s.innerHTML=`<td>${o.fileName}</td>\n        <td>${o.lastModifiedTime}</td>\n        <td class="has-text-right">${o.sizeInMegabytes.toFixed(2)} MB</td>\n        <td>\n          <div class="field is-grouped">\n            <div class="control">\n              <a class="button is-link" href="${t.urlPrefix}/backups/${o.fileName}" download>\n                <span class="icon"><i class="fas fa-download" aria-hidden="true"></i></span>\n                <span>Download</span>\n              </a>\n            </div>\n            <div class="control">\n              <button class="button is-light is-danger is-delete-button" aria-label="Delete Backup">\n                <i class="fas fa-trash" aria-hidden="true"></i>\n              </button>\n            </div>\n          </div>\n        </td>`,null===(e=s.querySelector(".is-delete-button"))||void 0===e||e.addEventListener("click",n),null===(a=l.querySelector("tbody"))||void 0===a||a.append(s)}}else l.innerHTML='<div class="message is-info">\n        <p class="message-body">\n        <strong>There are no backup files in the application\'s backup folder.</strong><br />\n        Note that your systems administrator may be backing up the database in another way.\n        </p>\n        </div>'}function o(){cityssm.postJSON(`${t.urlPrefix}/admin/doBackupDatabase`,{},e=>{const a=e;a.success?(s=a.backupFiles,bulmaJS.alert({message:"Database backed up successfully.",contextualColorName:"success"}),l()):bulmaJS.alert({title:"Error Backing Up Database",message:"Please try again.",contextualColorName:"danger"})})}function i(){cityssm.postJSON(`${t.urlPrefix}/admin/doCleanupDatabase`,{},e=>{const a=e;a.success?bulmaJS.alert({title:"Database Cleaned Up Successfully.",message:`${a.deleteCount} record(s) permanently deleted.`,contextualColorName:"success"}):bulmaJS.alert({title:"Error Cleaning Up Database",message:"Please try again.",contextualColorName:"danger"})})}null===(e=document.querySelector(".is-backup-button"))||void 0===e||e.addEventListener("click",()=>{bulmaJS.confirm({title:"Backup Database",message:"Are you sure you want to backup the application's database?",contextualColorName:"info",okButton:{text:"Yes, Backup Database",callbackFunction:o}})}),null===(a=document.querySelector(".is-cleanup-button"))||void 0===a||a.addEventListener("click",()=>{bulmaJS.confirm({title:"Cleanup Database",message:"<strong>Are you sure you want to cleanup the database?</strong><br />\n        The cleanup process may speed up the application by purging previously deleted records.",messageIsHtml:!0,contextualColorName:"warning",okButton:{text:"Yes, Cleanup Database",callbackFunction:i}})}),l()})();